(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{60:function(e,t,a){e.exports=a(93)},72:function(e,t,a){},81:function(e,t,a){},83:function(e,t,a){},85:function(e,t,a){},87:function(e,t,a){},89:function(e,t,a){},91:function(e,t,a){},93:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(56),o=a(6),s=a(37),c=a(101),u=a(1),l="GET_LOGS",p="USER_SEARCH";var d="AUTOREFRESH";var h="SET_AUTOREFRESH";var f="SET_LOGS";var m="SET_QUERY";var y="SET_SEARCH_PERIOD";var v="AVAILABLE_APPS_LOADED";var b="CLEAR_DATA";var g="LOAD_PROFILE";var O="PROFILE_LOADED";var j="SET_CREDENTIALS";function k(e){return{type:j,payload:{credentials:e}}}var E="TRY_FIND_CREDENTIALS";var S={none:0,apiKey:1,aad:2},A=function(){return{logs:[],credentials:{api:{appId:"",apiKey:""},aad:{subscriptionId:"",resourceId:"",appId:"",authenticated:!1},authenticationType:S.aad},query:"traces | sort by timestamp desc | limit 50",searchPeriod:"",autoRefresh:!0,refreshInterval:null,appName:null,fetchTime:null,loading:!1,error:null,availableApps:[],aad:{subscriptionsApps:{},subscriptions:[]},ui:{theme:"theme-default"}}};var w="CHANGE_UI_THEME",T=[{name:"Dark (default)",className:"theme-default"},{name:"Light",className:"theme-light"}];function C(e){return{type:w,payload:{theme:e}}}var N="ERROR";function I(e){return{type:N,payload:e}}var D="LIST_AAD_SUBSCRIPTIONS";var R="AAD_SUBSCRIPTIONS_LOADED";var _="LIST_AI_APPS";var L="AI_APPS_LOADED";var P="AAD_LOGIN";var q="AAD_LOGOUT";var U="AAD_SILENT_REFRESH";function H(e){var t=e.retry?e.retry++:1;return{type:U,payload:{retryAction:Object(u.a)({},e,{retry:t})}}}var K,M,F=(K=[function(e,t){if(t.type===b)return Object(u.a)({},A())},function(e,t){if(t.type===O){var a=Object(u.a)({},e.credentials);t.payload.credentials&&(a.authenticationType=t.payload.credentials.authenticationType,a.aad=Object(u.a)({},a.aad,t.payload.credentials.aad),a.api=Object(u.a)({},a.api,t.payload.credentials.api));var n=e.query;return t.payload.query&&(n=t.payload.query),Object(u.a)({},e,{credentials:a,query:n})}},function(e,t){if(t.type===O||t.type===v){var a={};return t.payload.availableApps&&(a.availableApps=t.payload.availableApps),Object(u.a)({},e,a)}},function(e,t){if(t.type===j)return Object(u.a)({},e,{credentials:t.payload.credentials})},function(e,t){if(t.type===R){var a=t.payload.subscriptions,n=Object(u.a)({},e.aad,{subscriptions:a});return Object(u.a)({},e,{aad:n})}},function(e,t){if(t.type===L){var a=t.payload,n=a.subscriptionId,r=a.apps,i=Object(u.a)({},e.aad.subscriptionsApps);return i[n]=r,Object(u.a)({},e,{aad:Object(u.a)({},e.aad,{subscriptionsApps:i})})}},function(e,t){if(t.type===h)return Object(u.a)({},e,{autoRefresh:t.payload.enabled})},function(e,t){if(t.type===m)return Object(u.a)({},e,{query:t.payload.query})},function(e,t){if(t.type===y)return Object(u.a)({},e,{searchPeriod:t.payload.searchPeriod})},function(e,t){if(t.type===f)return Object(u.a)({},e,{logs:t.payload.logs,appName:t.payload.appName,fetchTime:t.payload.fetchTime,loading:!1,error:null})},function(e,t){if(t.type===l){var a=t.payload.source===d&&e.error;return Object(u.a)({},e,{loading:!a})}},function(e,t){if(t.type===w){var a=Object(u.a)({},e.ui,{theme:t.payload.theme});return Object(u.a)({},e,{ui:Object(u.a)({},a)})}},function(e,t){if(t.type===N)return Object(u.a)({},e,{error:t.payload,loading:!1})}],M=A(),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0,a=e;return K.forEach(function(e){var n=e(a,t);n&&(a=n)}),a}),Q=a(102),x=a(105),z=a(96),B=a(97),W=a(12);function G(e){return e.authenticationType!==S.none&&(e.authenticationType===S.aad?!(!e.aad.authenticated||!e.aad.subscriptionId||!e.aad.resourceId):e.authenticationType===S.apiKey?!(!e.api.appId||!e.api.apiKey):void 0)}var J=function(e){return e.value.autoRefresh&&!e.value.loading},Y=function(e){return e.type===O&&G(e.payload.credentials)},V=a(94),Z=a(70),$=a(98),X=a(99),ee=a(69);var te=function(e){return e.credentials.authenticationType===S.aad},ae=function(e){return+e.retry>1},ne=function(e){return+e.retry>1},re=function(e){return+e.retry>1},ie=Object(Q.a)(function(e,t,a){var n=a.inject,r=n("ApplicationInsightsClient"),i=n("DomUtils");return e.pipe(Object(ee.a)(l,O),Object(z.a)(function(e){var a=t.value;return G(a.credentials)&&!(e.payload.source===d&&a.error)&&!ae(e)}),Object(B.a)(function(e){var a=function(e,t){return e.payload.source!==d||t.isScrollEnd(".ail-body")}(e,i),n=t.value;return r.getLogs(n.credentials,n.query,n.searchPeriod).pipe(Object(Z.a)(function(e){return Object(V.a)(function(e){return{type:f,payload:e}}(e),k(Object(u.a)({},t.value.credentials,{appName:e.appName})))}),Object($.a)(function(a){if(401===a.status)return Object(V.a)(te(t.value)&&!ae(e)?H(e):I("Error 401 - Unauthorized"));var n="string"===typeof a?a:a.message;return Object(V.a)(I(n||"Error when getting logs"))}),Object(X.a)(function(){a&&i.scrollBottom(".ail-body")}))}))},function(e,t){return e.pipe(Object(z.a)(function(e){return e.type===h&&e.payload.enabled||J(t)&&(e.type===f||Y(e))}),Object(B.a)(function(e){return Object(x.a)(3e4).pipe(Object(W.a)(function(e){return J(t)?{type:l,payload:{source:d}}:{type:"never",payload:{}}}))}))},function(e,t,a){var n=(0,a.inject)("ProfileRepository");return e.pipe(Object(ee.a)(j),Object(B.a)(function(e){n.storeCredentials(e.payload.credentials);var t=n.getStoredAppNamesCredentials();return Object(V.a)(function(e){return{type:v,payload:{availableApps:e}}}(t))}))},function(e,t,a){var n=(0,a.inject)("ProfileRepository");return e.pipe(Object(ee.a)(E),Object(B.a)(function(e){return Object(V.a)(n.findCredentialsCanditate(e.payload.appName)).pipe(Object(W.a)(function(e){return e?k(e):{type:"never",payload:{}}}))}))},function(e,t,a){var n=(0,a.inject)("ProfileRepository");return e.pipe(Object(ee.a)(m),Object(B.a)(function(e){return n.storeQuery(e.payload.query),Object(V.a)({type:"never",payload:{}})}))},function(e,t,a){var n=(0,a.inject)("ProfileRepository");return e.pipe(Object(ee.a)(b),Object(B.a)(function(e){return n.clearData(),Object(V.a)({type:"never",payload:{}})}))},function(e,t,a){var n=a.inject,r=n("ProfileRepository"),i=n("ConsoleDoc"),o=n("AadAuthService");return e.pipe(Object(ee.a)(g),Object(B.a)(function(e){i.printHelpOnConsole();var t=r.getCredentials(),a=r.getStoredAppNamesCredentials();t.aad.authenticated=o.isAuthenticated(),!t.authenticationType&&t.aad.authenticated&&(t.authenticationType=S.aad);var n=r.getQuery();return Object(V.a)(function(e,t,a){return{type:O,payload:{credentials:e,query:t,availableApps:a}}}(t,n,a))}))},function(e,t,a){var n=(0,a.inject)("ApplicationInsightsClient");return e.pipe(Object(ee.a)(D),Object(z.a)(function(e){return t.value.credentials.aad.authenticated&&!ne(e)}),Object(B.a)(function(e){return n.listSubscriptions().pipe(Object(W.a)(function(e){return function(e){return{type:R,payload:{subscriptions:e}}}(e)}),Object($.a)(function(t){if(401===t.status&&!ne(e))return Object(V.a)(H(e));var a=t.response&&t.response.error?" ".concat(t.response.error.code,": ").concat(t.response.error.message):"";return Object(V.a)(I("Error loading subscriptions => [HTTP Status ".concat(t.status,"]").concat(a)))}))}))},function(e,t,a){var n=(0,a.inject)("ApplicationInsightsClient");return e.pipe(Object(ee.a)(_),Object(z.a)(function(e){return t.value.credentials.aad.authenticated&&!re(e)}),Object(B.a)(function(e){var t=e.payload.subscriptionId;return n.listAppInsightsAccounts(t).pipe(Object(W.a)(function(e){return function(e,t){return{type:L,payload:{subscriptionId:e,apps:t}}}(t,e)}),Object($.a)(function(t){if(401===t.status&&!re(e))return Object(V.a)(H(e));var a=t.response&&t.response.error?" ".concat(t.response.error.code,": ").concat(t.response.error.message):"";return Object(V.a)(I("Error loading subscription apps => [HTTP Status ".concat(t.status,"]").concat(a)))}))}))},function(e,t,a){var n=(0,a.inject)("AadAuthService");return e.pipe(Object(ee.a)(P),Object(W.a)(function(){return n.loginRedirect(),{type:"never",payload:{}}}))},function(e,t,a){var n=(0,a.inject)("AadAuthService");return e.pipe(Object(ee.a)(q),Object(W.a)(function(){return n.logout(),{type:"never",payload:{}}}))},function(e,t,a){var n=(0,a.inject)("AadAuthService");return e.pipe(Object(ee.a)(U),Object(z.a)(function(e){return t.value.credentials.authenticationType===S.aad}),Object(Z.a)(function(e){return n.silentTokenRefresh().pipe(Object(W.a)(function(t){t.success||alert("An error has occurred while refreshing token silently: ".concat(t.errorMessage));var a=e.payload.retryAction;return a||{type:"never",payload:{}}}))}))},function(e,t,a){var n=(0,a.inject)("ProfileRepository");return e.pipe(Object(ee.a)(w),Object(B.a)(function(e){return n.setUITheme(e.payload.theme),Object(V.a)({type:"never",payload:{}})}))},function(e,t,a){var n=(0,a.inject)("ProfileRepository");return e.pipe(Object(ee.a)(g),Object(B.a)(function(e){var t=n.getUITheme();return t?Object(V.a)(C(t)):Object(V.a)({type:"never",payload:{}})}))}),oe=a(3),se=a(4),ce=function(){function e(){Object(oe.a)(this,e)}return Object(se.a)(e,[{key:"scrollBottom",value:function(e){document.querySelector(e).scrollTo(0,document.querySelector(e).scrollHeight)}},{key:"isScrollEnd",value:function(e){return document.querySelector(e).scrollTop+document.querySelector(e).offsetHeight===document.querySelector(e).scrollHeight}},{key:"listenViewHeightChanges",value:function(){function e(){var e=Math.max(document.documentElement.clientHeight,window.innerHeight||0);document.body.style.height="".concat(e,"px")}e(),window.addEventListener("onorientationchange",e,!0),window.addEventListener("resize",e,!0)}}]),e}(),ue=function(){function e(){Object(oe.a)(this,e)}return Object(se.a)(e,[{key:"printHelpOnConsole",value:function(){console.log("Hello! Here are some tips you must think useful:\nQuery documentation (https://docs.loganalytics.io/docs/Language-Reference/):\nSeverity levels:\n0: 'verbose',\n1: 'information',\n2: 'warning',\n3: 'error',\n4: 'critical'\n\nQuery samples:\ntraces | where severityLevel > 2 | sort by timestamp desc | limit 200\ntraces | where message has 'Error' | sort by timestamp desc | limit 200\nexceptions | sort by timestamp desc | limit 200\nunion exceptions, traces | sort by timestamp desc | limit 200\ntraces | where timestamp > todatetime(\"2018-04-26 10:20:00Z\") | sort by timestamp desc | limit 100\ntraces | where timestamp > ago(1h)\n\nShare a url: ".concat(window.location.href.split("?")[0],"?app_id={your_app_id}&api_key={your_api_key}"))}}]),e}(),le=a(59),pe=function(){function e(){Object(oe.a)(this,e)}return Object(se.a)(e,[{key:"getParams",value:function(){if(!window.location)return{};var e=window.location.search;return e?(/^[?#]/.test(e)?e.slice(1):e).split("&").reduce(function(e,t){var a=t.split("="),n=Object(le.a)(a,2),r=n[0],i=n[1];return e[r]=i?decodeURIComponent(i.replace(/\+/g," ")):"",e},{}):{}}},{key:"removeParams",value:function(){if(window.history){var e=window.location.href.split("?");window.history.pushState({},"",e[0])}}}]),e}(),de=function(){function e(){Object(oe.a)(this,e)}return Object(se.a)(e,[{key:"formatDate",value:function(e){return"".concat(this.formatTwoDigit(e.getFullYear()),"-").concat(this.formatTwoDigit(e.getMonth()+1),"-").concat(this.formatTwoDigit(e.getDate()))}},{key:"formatTime",value:function(e){return"".concat(this.formatTwoDigit(e.getHours()),":").concat(this.formatTwoDigit(e.getMinutes()),":").concat(this.formatTwoDigit(e.getSeconds()))}},{key:"formatDateTime",value:function(e){return e?this.formatDate(e)+" "+this.formatTime(e):"-"}},{key:"formatTwoDigit",value:function(e){return e<10?"0".concat(e):e}}]),e}(),he=function(){function e(t,a){Object(oe.a)(this,e),this.storageRepository=t,this.queryStringUtils=a}return Object(se.a)(e,[{key:"getCredentials",value:function(){var e=this.getCredentialsFromQuery();if(e)return e;var t=this.storageRepository.getSessionData("credentials",!0);return t?fe(t):this.storageRepository.getLocalData("lruCredentials",!0)?fe(t):fe()}},{key:"storeCredentials",value:function(e){this.storageRepository.saveSessionData("credentials",e,!0),this.storageRepository.saveLocalData("lruCredentials",e,!0),e.authenticationType===S.apiKey&&e.appName&&this.storeAppCredentials(e,e.appName)}},{key:"getQuery",value:function(){return this.storageRepository.getSessionData("query")}},{key:"storeQuery",value:function(e){this.storageRepository.saveSessionData("query",e)}},{key:"storeAppCredentials",value:function(e,t){if(t&&e.appId&&e.apiKey&&e.appId!==t){var a=this.getAllCredentials()||{};a[t]=e,this.storageRepository.saveLocalData("credentialsByApp",a,!0)}}},{key:"getAllCredentials",value:function(){return this.storageRepository.getLocalData("credentialsByApp",!0)}},{key:"getStoredAppNamesCredentials",value:function(){var e=this.getAllCredentials();return e?Object.keys(e):[]}},{key:"findCredentialsCanditate",value:function(e){var t=this.getAllCredentials();return t?{authenticationType:S.apiKey,api:t[e]}:null}},{key:"getUITheme",value:function(){return this.storageRepository.getLocalData("ui-theme")}},{key:"setUITheme",value:function(e){this.storageRepository.saveLocalData("ui-theme",e)}},{key:"getCredentialsFromQuery",value:function(){var e=this.queryStringUtils.getParams();return e.app_id&&e.api_key?(this.queryStringUtils.removeParams(),fe({authenticationType:S.apiKey,api:{appId:e.app_id,apiKey:e.api_key}})):null}},{key:"clearData",value:function(){this.storageRepository.clearSessionData(),this.storageRepository.clearLocalData()}}]),e}();function fe(e){var t=(e=e||{}).appId||"",a=e.apiKey||"",n=e.authenticationType?e.authenticationType:S.none;return t&&a&&(n=S.apiKey),{authenticationType:n,api:e.api?e.api:{appId:t,apiKey:a},aad:e.aad?e.aad:{subscriptionId:"",resourceId:"",appId:"",authenticated:!1}}}var me=function(){function e(t,a){Object(oe.a)(this,e),this.localStorage=t,this.sessionStorage=a}return Object(se.a)(e,[{key:"getSessionData",value:function(e,t){if(t){var a=this.sessionStorage.getItem(e);try{return a?JSON.parse(a):null}catch(n){return null}}return this.sessionStorage.getItem(e)}},{key:"saveSessionData",value:function(e,t,a){this.sessionStorage.setItem(e,a?JSON.stringify(t):t)}},{key:"removeSessionData",value:function(e){this.sessionStorage.removeItem(e)}},{key:"clearSessionData",value:function(){this.sessionStorage.clear()}},{key:"getLocalData",value:function(e,t){if(t){var a=this.localStorage.getItem(e);try{return a?JSON.parse(a):null}catch(n){return null}}return this.localStorage.getItem(e)}},{key:"saveLocalData",value:function(e,t,a){this.localStorage.setItem(e,a?JSON.stringify(t):t)}},{key:"removeLocalData",value:function(e){this.localStorage.removeItem(e)}},{key:"clearLocalData",value:function(){this.localStorage.clear()}}]),e}(),ye=a(71),ve=function(e,t){if(!ge(["timestamp","message"],e,t))return null;var a={};return a.timestamp=new Date(e[t.timestamp]),a.severityLevel=e[t.severityLevel]||0,a.message=e[t.message],a},be={trace:ve,exception:function(e,t){if(!ge(["timestamp"],e,t))return null;var a={};return a.timestamp=new Date(e[t.timestamp]),a.severityLevel=e[t.severityLevel]||0,a.message=[e[t.problemId],e[t.outerMessage]].filter(function(e){return null!=e}).join(": "),e[t.outerMessage]!==e[t.innermostMessage]&&e[t.innermostMessage]&&(a.message+="\r\n"+[e[t.innermostType],e[t.innermostMessage]].filter(function(e){return null!=e}).join(": ")),a},log:ve,props:function(e,t){if(!ge(["timestamp"],e,t))return null;var a={};return a.timestamp=new Date(e[t.timestamp]),a.severityLevel=e[t.severityLevel]||0,a.message="",Object.keys(t).filter(function(e){return"timestamp"!==e&&"severityLevel"!==e}).forEach(function(n){a.message+="".concat(n,": ").concat(e[t[n]],"\n")}),a}};function ge(e,t,a){return e.every(function(e){return null!=t[a[e]]})}var Oe=function(){function e(t,a){Object(oe.a)(this,e),this.httpClient=t,this.aadAuthService=a}return Object(se.a)(e,[{key:"getLogs",value:function(e,t,a){var n=this,r=[{name:"query",value:t},{name:"api-version",value:"2018-05-01-preview"}];a&&r.push({name:"timespan",value:a});try{return this.httpClient.get("".concat(this.buildAppUri(e),"/query"),this.buildHeaders(e),r).pipe(Object(W.a)(function(e){return n.mapQueryResponse(e.response)}),Object($.a)(function(e){if(console.error(e.response),401===e.status)return Object(ye.a)(e);if(e.response&&e.response.error){var t=n.mapError("",e.response.error);return Object(ye.a)(t)}return"string"===typeof e.response?Object(ye.a)("".concat(e.status,": ").concat(e.response)):Object(ye.a)(e)}))}catch(i){return Object(ye.a)(i)}}},{key:"mapError",value:function(e,t){return t&&t.message?this.mapError("".concat(e).concat(t.message,". "),t.innererror):"".concat(e)}},{key:"buildAppUri",value:function(e){if(e.authenticationType===S.aad)return"https://management.azure.com/".concat(e.aad.resourceId,"/api");if(e.authenticationType===S.apiKey)return"https://api.applicationinsights.io/v1/apps/".concat(e.api.appId);throw new Error("You must setup an authentication to fetch logs")}},{key:"buildHeaders",value:function(e){if(e.authenticationType===S.none)throw new Error("You must setup an authentication");return e.authenticationType===S.aad?this.buildAadAuthorizationHeaders():{"x-api-key":e.api.apiKey}}},{key:"buildAadAuthorizationHeaders",value:function(){if(!this.aadAuthService.isAuthenticated())throw new Error("You must be authenticated to your Azure Active Directory tenant");var e=this.aadAuthService.getToken();return{Authorization:"Bearer ".concat(e)}}},{key:"mapQueryResponse",value:function(e){if(!(e=function e(t){if(Array.isArray(t))return t.map(function(t){return"object"===typeof t&&(t=e(t)),t});if("object"===typeof t){var a=null;for(var n in t)if(a||(a={}),t.hasOwnProperty(n)){var r=(n.charAt(0).toLowerCase()+n.slice(1)||n).toString(),i=t[n];(i instanceof Array||null!=i&&i.constructor===Object)&&(i=e(i)),a[r]=i}return a}return t}(e))||!e.tables)throw new Error("Unexpected response content from query");var t=function(e){var t={};return e.tables[0].columns.forEach(function(e,a){var n=e.name||e.columnName;t[n]=a}),t}(e);return{logs:e.tables[0].rows.map(function(e){var a=function(e,t){var a=e[t.itemType];return be[a]?be[a]:ge(["timestamp","message"],e,t)?be.log:be.props}(e,t);return a?a(e,t):null}).filter(function(e){return null!==e}).sort(function(e,t){return e.timestamp===t.timestamp?0:e.timestamp>t.timestamp?1:-1}),appName:this.getAppName(e,t),fetchTime:new Date}}},{key:"getAppName",value:function(e,t){if(e.tables[0].rows.length<1)return null;var a=t.appName;return e.tables[0].rows[0][a]}},{key:"listAppInsightsAccounts",value:function(e){var t="https://management.azure.com/subscriptions/".concat(e,"/providers/Microsoft.Insights/components");return this.httpClient.get(t,this.buildAadAuthorizationHeaders(),[{name:"api-version",value:"2015-05-01"}]).pipe(Object(W.a)(function(e){return e.response.value.map(function(e){return{id:e.id,name:e.name,appId:e.properties.AppId}})}))}},{key:"listSubscriptions",value:function(){return this.httpClient.get("https://management.azure.com/subscriptions",this.buildAadAuthorizationHeaders(),[{name:"api-version",value:"2015-05-01"}]).pipe(Object(W.a)(function(e){return e.response.value.map(function(e){return{id:e.subscriptionId,name:e.displayName}})}))}}]),e}(),je=a(104),ke=function(){function e(){Object(oe.a)(this,e)}return Object(se.a)(e,[{key:"get",value:function(e,t,a){return this.request("GET",e,t,a)}},{key:"post",value:function(e,t,a,n){return this.request("POST",e,a,n,t)}},{key:"put",value:function(e,t,a,n){return this.request("PUT",e,a,n,t)}},{key:"delete",value:function(e,t,a){return this.request("DELETE",e,t,a)}},{key:"request",value:function(e,t,a,n,r){var i={Accept:"application/json","Content-Type":"application/json"};a&&(i=Object(u.a)({},i,a));var o=function(e){return e&&e.length?e.map(function(e){return"".concat(e.name,"=").concat(encodeURIComponent(e.value))}).join("&"):null}(n);return Object(je.a)({url:o?"".concat(t,"?").concat(o):t,method:e,headers:i,responseType:"json",body:r})}}]),e}();var Ee=a(100),Se=a(106),Ae=a(103),we=function(){function e(t){Object(oe.a)(this,e),this.storageRepository=t,this.clientId="430747df-8753-4f94-89ee-c6524d00cd62",this.scopes=["openid","profile","https://management.azure.com/user_impersonation"],this.iframeName="aad-silent-refresh",this.refreshingToken=!1,this.tokenSubject=new Ae.a,this.checkResponseCallback()}return Object(se.a)(e,[{key:"checkResponseCallback",value:function(){var e=this.parseFragmentParams();if(e)if(e.error){var t="Error: ".concat(e.error,"\nDetails: ").concat(e.error_description);Te()?this.postMessageToParent({type:Ce.refresh_token_error,errorMessage:t}):(this.storageRepository.removeSessionData("access_token"),alert(t)),this.setHash("")}else e.access_token&&(Te()?this.postMessageToParent({type:Ce.refresh_token_success,accessToken:e.access_token}):this.storageRepository.saveSessionData("access_token",e.access_token),this.setHash(""))}},{key:"logout",value:function(){this.storageRepository.removeSessionData("access_token")}},{key:"silentTokenRefresh",value:function(){var e=this;if(Te()){var t="silentTokenRefresh should not be run in an iframe";return console.warn(t),Object(V.a)({success:!1,errorMessage:t})}if(this.refreshingToken)return console.warn("Refresh token silent is already in progress"),this.tokenSubject;this.refreshingToken=!0,this.createIFrameIfNotExists();var a=this.buildLoginUrl("none");return setTimeout(function(){return window.open(a,e.iframeName)},1e3),Object(Ee.a)(window,"message").pipe(Object(z.a)(function(e){if(e.origin!==window.origin)return!1;var t=null;try{t=JSON.parse(e.data)}catch(a){}return t&&(t.type===Ce.refresh_token_success||t.type===Ce.refresh_token_error)}),Object(W.a)(function(e){return JSON.parse(e.data)}),Object(W.a)(function(t){return t.type===Ce.refresh_token_success?e.storageRepository.saveSessionData("access_token",t.accessToken):(e.storageRepository.removeSessionData("access_token"),e.storageRepository.saveSessionData("aad.error",t.errorMessage)),e.refreshingToken=!1,document.querySelector("#".concat(e.iframeName)).remove(),{success:t.type===Ce.refresh_token_success,errorMessage:t.errorMessage?t.errorMessage:null}}),Object(Se.a)(1),Object(X.a)(function(t){return e.tokenSubject.next(t)}))}},{key:"createIFrameIfNotExists",value:function(){if(!document.querySelector("#".concat(this.iframeName))){var e=document.createElement("iframe");e.setAttribute("id",this.iframeName),e.setAttribute("name",this.iframeName),e.setAttribute("hidden","true"),document.body.appendChild(e)}}},{key:"loginRedirect",value:function(){var e=this.buildLoginUrl();document.location.href=e}},{key:"getToken",value:function(){return this.storageRepository.getSessionData("access_token")}},{key:"isAuthenticated",value:function(){return!Te()&&null!=this.getToken()}},{key:"getHash",value:function(){return document.location.hash}},{key:"setHash",value:function(e){return document.location.hash=e}},{key:"postMessageToParent",value:function(e){window.parent.postMessage(JSON.stringify(e),"*")}},{key:"buildLoginUrl",value:function(e){e||(e="select_account");var t=[{name:"client_id",value:this.clientId},{name:"response_type",value:"token"},{name:"redirect_uri",value:document.location.origin},{name:"scope",value:this.scopes.join(" ")},{name:"prompt",value:e}];return"https://login.microsoftonline.com/".concat("organizations","/oauth2/v2.0/authorize?").concat(this.formatQuery(t))}},{key:"parseFragmentParams",value:function(){return""===this.getHash()?null:this.getHash().substring(1).split("&").map(function(e){var t=e.split("=");return{name:t[0],value:decodeURIComponent(t[1].replace(/\+/g,"%20"))}}).reduce(function(e,t){return e[t.name]=t.value,e},{})}},{key:"formatQuery",value:function(e){return e.map(function(e){return"".concat(e.name,"=").concat(encodeURIComponent(e.value))}).join("&")}}]),e}();function Te(){try{return window.self!==window.top}catch(e){return!0}}var Ce={refresh_token_success:"refresh_token_success",refresh_token_error:"refresh_token_error"},Ne={ApplicationInsightsClient:function(e){return new Oe(e("HttpClient"),e("AadAuthService"))},ProfileRepository:function(e){return new he(e("StorageRepository"),e("QueryStringUtils"))},DomUtils:function(){return new ce},ConsoleDoc:function(){return new ue},QueryStringUtils:function(){return new pe},DateUtils:function(){return new de},HttpClient:function(){return new ke},AadAuthService:function(e){return new we(e("StorageRepository"))},StorageRepository:function(){var e=window.localStorage,t=window.sessionStorage;return new me(e,t)}};function Ie(e){var t=Ne[e];if(!t)throw new Error("".concat(e," is not registered"));return t(Ie)}var De=Object(c.a)({dependencies:{inject:Ie}}),Re=Object(s.c)(F,Object(s.a)(De));De.run(ie);var _e=Re,Le=(a(72),a(18)),Pe=a(16),qe=a(17),Ue=(a(81),a(83),function(e){var t=e.sidebar,a=e.toggleSidebar,n=e.appName,i=e.loading,o="ail-header-title_icon ".concat(i?"ail-header-title_icon--loading":"");return r.a.createElement("header",{className:"ail-header"},r.a.createElement("div",{className:"ail-header-app_name",hidden:!n},n),r.a.createElement("strong",{className:"ail-header-title"},r.a.createElement("span",{className:o,role:"img","aria-labelledby":"ail-header-title"},"\ud83d\udca1 "),r.a.createElement("span",{id:"ail-header-title"},"Application Insights Log")),r.a.createElement("div",{className:"ail-credentials-menu"},r.a.createElement("div",{className:"ail-icon-menu ".concat(t?"open":""),onClick:function(){return a()}},r.a.createElement("span",null),r.a.createElement("span",null),r.a.createElement("span",null),r.a.createElement("span",null),r.a.createElement("span",null),r.a.createElement("span",null))))}),He={0:"verbose",1:"information",2:"warning",3:"error",4:"critical"},Ke=(a(85),Ie("DateUtils")),Me=function(e){var t=e.log;return r.a.createElement("div",{className:"ail-log_line ail-log_line--".concat(He[t.severityLevel])},r.a.createElement("span",{className:"ail-log_line-time"},"[",Ke.formatDateTime(t.timestamp),"]"),r.a.createElement("span",{className:"ail-log_line-message"},t.message))},Fe=Ie("DateUtils"),Qe=function(e){var t=e.logs,a=e.fetchTime,i=e.appName;return r.a.createElement(n.Fragment,null,r.a.createElement("h1",null,i||"No results"),r.a.createElement("div",{className:"ail-log"},t.map(function(e,t){return r.a.createElement(Me,{log:e,key:Fe.formatDate(a)+t})})))},xe=Qe=Object(o.b)(function(e){return{logs:e.logs,fetchTime:e.fetchTime,appName:e.appName}})(Qe),ze=a(40),Be=a(50),We=(a(87),a(39)),Ge=function(e){function t(e){var a;return Object(oe.a)(this,t),(a=Object(Le.a)(this,Object(Pe.a)(t).call(this,e))).state={},a.handleThemeChange=a.handleThemeChange.bind(Object(We.a)(Object(We.a)(a))),a}return Object(qe.a)(t,e),Object(se.a)(t,[{key:"handleThemeChange",value:function(e){this.props.changeTheme(e)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"ail-credentials-section"},r.a.createElement("label",null,"UI Theme"),r.a.createElement("div",{className:"ail-btn ail-btn--default",onClick:function(){return e.handleThemeChange(e.props.nextTheme.className)}},"Toggle ",this.props.nextTheme.name," theme"))}}]),t}(n.Component),Je=Ge=Object(o.b)(function(e){var t=T.findIndex(function(t){return t.className===e.ui.theme});return t=t<T.length-1?t+1:0,{nextTheme:T[t],theme:e.ui.theme}},function(e){return{changeTheme:function(t){return e(C(t))}}})(Ge),Ye=function(e){function t(e){var a;return Object(oe.a)(this,t),(a=Object(Le.a)(this,Object(Pe.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.checkSubscriptionsLoad(a.props),a.props.setCredentials(a.state.credentials)},a.validCredentials=function(){return a.state.credentials.aad.resourceId&&a.state.credentials.aad.subscriptionId},a.selectResource=function(e){var t=a.props.subscriptionsApps[a.state.credentials.aad.subscriptionId].find(function(t){return t.id===e}),n=a.state.credentials.aad,r=t?t.appId:"";n=Object(u.a)({},n,{resourceId:e,appId:r}),a.props.setCredentials(Object(u.a)({},a.state.credentials,{aad:n}))},a.selectSubscription=function(e){var t=a.state.credentials.aad;t=Object(u.a)({},t,{subscriptionId:e,resourceId:"",appId:""}),a.props.setCredentials(Object(u.a)({},a.state.credentials,{aad:t}))},a.login=function(){a.props.login()},a.logout=function(){a.props.logout()},a.state={credentials:e.credentials},a}return Object(qe.a)(t,e),Object(se.a)(t,[{key:"checkSubscriptionsLoad",value:function(e){e.credentials.authenticationType===S.aad&&e.credentials.aad.authenticated&&0===e.subscriptions.length&&this.props.listSubscriptions()}},{key:"componentWillReceiveProps",value:function(e){if(e.credentials.aad.authenticated){this.checkSubscriptionsLoad(e);var t=e.credentials.aad.subscriptionId;t&&this.state.credentials.aad.subscriptionId!==t&&!e.subscriptionsApps[t]&&this.props.listAIApps(t)}this.setState({credentials:Object(u.a)({},e.credentials)})}},{key:"renderSubscriptionsDropDown",value:function(){var e=this;if(!this.state.credentials.aad.authenticated)return"";var t=this.props.subscriptions;return r.a.createElement("div",{className:"ail-credentials-section"},r.a.createElement("label",null,"Subscription"),r.a.createElement("select",{value:this.state.credentials.aad.subscriptionId,className:"ail-input",onChange:function(t){return e.selectSubscription(t.target.value)}},r.a.createElement("option",{value:""},"Select subscription"),t.map(function(e){return r.a.createElement("option",{key:e.id,value:e.id},e.name)})))}},{key:"renderAppsDropDown",value:function(){var e=this;if(!this.state.credentials.aad.authenticated)return"";var t=this.props.subscriptionsApps[this.state.credentials.aad.subscriptionId]||[];return 0===t.length?"":r.a.createElement("div",{className:"ail-credentials-section"},r.a.createElement("label",null,"Application Insights Resource"),r.a.createElement("select",{value:this.state.credentials.aad.resourceId,className:"ail-input",onChange:function(t){return e.selectResource(t.target.value)}},r.a.createElement("option",{value:""},"Select application"),t.map(function(e){return r.a.createElement("option",{key:e.id,value:e.id},e.name)})))}},{key:"renderLoginButton",value:function(){var e=this;return r.a.createElement(n.Fragment,null,this.props.credentials.aad.authenticated?r.a.createElement("button",{type:"button",className:"ail-btn ail-btn--success u-w100 u-mt-2",onClick:function(){return e.logout()}},"Logout ",r.a.createElement("span",{role:"img","aria-label":"lock"},"\ud83d\udd12")):r.a.createElement("button",{type:"button",className:"ail-btn ail-btn--default u-w100 u-mt-2",onClick:function(){return e.login()}},"Login ",r.a.createElement("span",{role:"img","aria-label":"key"},"\ud83d\udd11")))}},{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.handleSubmit},this.renderLoginButton(),this.renderSubscriptionsDropDown(),this.renderAppsDropDown())}}]),t}(n.Component),Ve=Ye=Object(o.b)(function(e){return{subscriptionsApps:Object(u.a)({},e.aad.subscriptionsApps),subscriptions:Object(Be.a)(e.aad.subscriptions),credentials:Object(u.a)({},e.credentials)}},function(e){return{setCredentials:function(t){return e(k(t))},listSubscriptions:function(){return e({type:D,payload:{}})},listAIApps:function(t){return e(function(e){return{type:_,payload:{subscriptionId:e}}}(t))},login:function(){return e({type:P,payload:{}})},logout:function(){return e({type:q,payload:{}})}}})(Ye),Ze=function(e){function t(e){var a;return Object(oe.a)(this,t),(a=Object(Le.a)(this,Object(Pe.a)(t).call(this,e))).changeAuthentication=function(e){a.props.setCredentials(Object(u.a)({},a.state.credentials,{authenticationType:e}))},a.state={credentials:e.credentials},a}return Object(qe.a)(t,e),Object(se.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({credentials:Object(u.a)({},e.credentials)})}},{key:"isActive",value:function(e){return this.props.credentials.authenticationType===e}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("label",null,"Authentication Mode"),r.a.createElement("div",{className:"ail-btn-group"},r.a.createElement("button",{type:"button",className:"ail-btn ".concat(this.isActive(S.aad)?"is-active":""," u-mt-2"),title:"Connect to Application Insights using an Azure Active Directory account",onClick:function(){return e.changeAuthentication(S.aad)}},"Azure AD"),r.a.createElement("button",{type:"button",className:"ail-btn ".concat(this.isActive(S.apiKey)?"is-active":""," u-mt-2"),title:"Connect to Application Insights using an AppID and Api key",onClick:function(){return e.changeAuthentication(S.apiKey)}},"API Key")))}}]),t}(n.Component),$e=Ze=Object(o.b)(function(e){return{credentials:Object(u.a)({},e.credentials)}},function(e){return{setCredentials:function(t){return e(k(t))}}})(Ze),Xe=function(e){function t(e){var a;return Object(oe.a)(this,t),(a=Object(Le.a)(this,Object(Pe.a)(t).call(this,e))).handleChange=function(e){var t=a.state.credentials.api;t=Object(u.a)({},t,Object(ze.a)({},e.target.id,e.target.value)),a.setState({credentials:Object(u.a)({},a.state.credentials,{api:t})})},a.handleSubmit=function(e){if(e.preventDefault(),a.state.editing){var t=a.state.credentials.api;a.props.setCredentials(Object(u.a)({},a.state.credentials,{api:t})),a.setState({editing:!a.state.editing})}else a.setState({editing:!a.state.editing})},a.clearData=function(){window.confirm("Are you sure to clear all stored data?")&&a.props.clearData()},a.validCredentials=function(){return a.state.credentials.api.appId&&a.state.credentials.api.apiKey},a.state={credentials:Object(u.a)({},e.credentials),availableApps:e.availableApps,selectedStoredCredential:"",editing:null===e.credentials.api.appId},a}return Object(qe.a)(t,e),Object(se.a)(t,[{key:"componentWillReceiveProps",value:function(e){!this.state.editing&&this.credentialsChanged(e.credentials,this.state.credentials)&&this.setState({credentials:e.credentials,selectedStoredCredential:""})}},{key:"handlePeriodChange",value:function(e){this.props.setSearchPeriod(e.target.value)}},{key:"checkStoredAppCredentials",value:function(e){this.setState({editing:!1}),this.props.tryFindCredentials(e),this.setState({selectedStoredCredential:e})}},{key:"toggleAutoRefresh",value:function(){this.props.setAutoRefresh(!this.props.autoRefresh)}},{key:"credentialsChanged",value:function(e,t){return e.api.appId!==t.api.appId||e.api.apiKey!==t.api.apiKey}},{key:"renderCredentialsForm",value:function(){var e=this;return r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement("div",{className:"ail-credentials-section ail-credentials"},r.a.createElement("label",null,"Credentials"),r.a.createElement("input",{className:"ail-input",value:this.state.credentials.api.appId,placeholder:"App id",id:"appId",disabled:!this.state.editing,onChange:function(t){return e.handleChange(t)}}),r.a.createElement("input",{className:"ail-input",value:this.state.credentials.api.apiKey,id:"apiKey",placeholder:"API key",disabled:!this.state.editing,onChange:function(t){return e.handleChange(t)}}),this.state.editing?r.a.createElement("button",{className:"ail-btn ail-btn--success u-w100 u-mt-2 ".concat(this.validCredentials()?"":"disabled")},"Apply"):r.a.createElement("button",{className:"ail-btn ail-btn--default u-w100 u-mt-2"},"Edit")),this.renderAppsDropDown())}},{key:"renderAppsDropDown",value:function(){var e=this;return 0===this.props.availableApps.length?"":r.a.createElement("div",{className:"ail-credentials-section"},r.a.createElement("label",null,"Switch apps"),r.a.createElement("select",{value:this.state.selectedStoredCredential,className:"ail-input",onChange:function(t){return e.checkStoredAppCredentials(t.target.value)}},r.a.createElement("option",null,"Saved apps"),this.props.availableApps.sort().map(function(e,t){return r.a.createElement("option",{key:t,value:e},e)})))}},{key:"renderGlobalOptions",value:function(){var e=this;return r.a.createElement("div",{className:"ail-credentials-section"},r.a.createElement("label",null,"Settings"),r.a.createElement("ul",{className:"ail-btn-list"},r.a.createElement("li",{className:"ail-toggle"},r.a.createElement("input",{className:"hidden",type:"checkbox",id:"autorefresh",checked:this.props.autoRefresh,onChange:function(t){return e.toggleAutoRefresh()}}),r.a.createElement("label",{htmlFor:"autorefresh",className:"ail-btn"},"Auto refresh")),r.a.createElement("li",{className:"ail-btn ail-btn--default",onClick:function(){return e.clearData()}},"Clear data")))}},{key:"renderPeriod",value:function(){var e=this;return r.a.createElement("div",{className:"ail-credentials-section"},r.a.createElement("label",null,"Search period"),r.a.createElement("input",{className:"ail-input",value:this.props.searchPeriod,placeholder:"Specify period (P7D, PT1H...)",id:"searchPeriod",onChange:function(t){return e.handlePeriodChange(t)}}))}},{key:"renderApplicationPicker",value:function(){return r.a.createElement(n.Fragment,null,this.props.credentials.authenticationType===S.apiKey?this.renderCredentialsForm():"",this.props.credentials.authenticationType===S.aad?r.a.createElement(Ve,null):"")}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement($e,null),this.renderApplicationPicker(),this.renderGlobalOptions(),this.renderPeriod(),r.a.createElement(Je,null))}}]),t}(n.Component),et=Xe=Object(o.b)(function(e){return{autoRefresh:e.autoRefresh,searchPeriod:e.searchPeriod,availableApps:Object(Be.a)(e.availableApps),credentials:Object(u.a)({},e.credentials)}},function(e){return{setCredentials:function(t){return e(k(t))},clearData:function(){return e({type:b,payload:null})},tryFindCredentials:function(t){return e(function(e){return{type:E,payload:{appName:e}}}(t))},setAutoRefresh:function(t){return e(function(e){return{type:h,payload:{enabled:e}}}(t))},setSearchPeriod:function(t){return e(function(e){return{type:y,payload:{searchPeriod:e}}}(t))}}})(Xe),tt=(a(89),function(e){function t(e){var a;return Object(oe.a)(this,t),(a=Object(Le.a)(this,Object(Pe.a)(t).call(this,e))).setQuery=function(e){a.setState({query:e.target.value})},a.handleSubmit=function(e){e.preventDefault(),a.props.setQuery(a.state.query),a.props.getLogs()},a.onEnterPress=function(e){13===e.keyCode&&!0===e.ctrlKey&&a.handleSubmit(e)},a.state={query:e.query},a}return Object(qe.a)(t,e),Object(se.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.state.query!==e.query&&this.setState({query:e.query})}},{key:"render",value:function(){return r.a.createElement("form",{className:"ail-footer",onSubmit:this.handleSubmit},r.a.createElement("textarea",{className:"ail-query",value:this.state.query,placeholder:"Write a query...",onKeyDown:this.onEnterPress,onChange:this.setQuery}),r.a.createElement("button",{className:"ail-search",disabled:!this.state.query||!this.props.connected},"Search"))}}]),t}(n.Component)),at=tt=Object(o.b)(function(e){return{query:e.query,connected:G(e.credentials)}},function(e){return{getLogs:function(){return e({type:l,payload:{source:p}})},setQuery:function(t){return e(function(e){return{type:m,payload:{query:e}}}(t))}}})(tt),nt=(a(91),Ie("DateUtils")),rt=function(e){return r.a.createElement("div",{className:"ail-footer-status"},e.connected?r.a.createElement("div",{className:"ail-footer-status-item ail-footer-status--timestamp"},e.loading?"Loading...":r.a.createElement("div",null,"updated at ",nt.formatDateTime(e.fetchTime)," ",e.autoRefresh?"(auto)":"")):r.a.createElement("div",{className:"ail-footer-status-item ail-footer-status--error"},"You must setup an authentication and an application on the right panel to start"),e.error?r.a.createElement("div",{className:"ail-footer-status-item ail-footer-status--error"},e.error):"")},it=rt=Object(o.b)(function(e){return{autoRefresh:e.autoRefresh,fetchTime:e.fetchTime,appName:e.appName,error:e.error,loading:e.loading,connected:G(e.credentials)}})(rt),ot=function(e){function t(e){var a;return Object(oe.a)(this,t),(a=Object(Le.a)(this,Object(Pe.a)(t).call(this,e))).state={sidebar:!1},a}return Object(qe.a)(t,e),Object(se.a)(t,[{key:"componentDidMount",value:function(){this.props.loadProfile()}},{key:"toggleSidebar",value:function(){this.setState({sidebar:!this.state.sidebar})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"ait ".concat(this.props.activeTheme," ").concat(this.state.sidebar?"ail--sidebar-open":"")},r.a.createElement("div",{className:"ail-container"},r.a.createElement(Ue,{sidebar:this.state.sidebar,loading:this.props.loading,toggleSidebar:function(){return e.toggleSidebar()},appName:this.props.appName}),r.a.createElement("div",{className:"ail-body"},this.props.hasCredentials?r.a.createElement(xe,null):r.a.createElement("h1",null,"Welcome! To start, first set your credentials on top menu.")),r.a.createElement("div",null,r.a.createElement(it,null),r.a.createElement(at,null))),r.a.createElement("div",{className:"ail-sidebar"},r.a.createElement(et,null)))}}]),t}(n.Component),st=ot=Object(o.b)(function(e){return{hasCredentials:e.credentials.authenticationType!==S.none,appName:!e.appName&&e.logs.length>0?"You must project appName property in the query":e.appName,loading:e.loading,activeTheme:e.ui.theme}},function(e){return{loadProfile:function(){return e({type:g})}}})(ot),ct=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ut(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}var lt=Ie("DomUtils");Object(i.render)(r.a.createElement(o.a,{store:_e},r.a.createElement(st,null)),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/application-insights-client",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/application-insights-client","/service-worker.js");ct?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):ut(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):ut(e)})}}(),lt.listenViewHeightChanges()}},[[60,2,1]]]);
//# sourceMappingURL=main.4d7cee66.chunk.js.map